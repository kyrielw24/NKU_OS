![image-20221023224158756](C:\Users\Kyrie\AppData\Roaming\Typora\typora-user-images\image-20221023224158756.png)

<h1 size=82><center><font size=8>OS-Lab2</font></center></h1>


<h3 align="center">姓名：刘伟</h3>

<h3 align="center">学号：2013029</h3>

<h3 align="center">专业：物联网工程</h3>

<h3 align="center">队友：王旭尧</h3>


## 实验

> lab2在lab1的基础上，添加了：
>
> - bootmain.S中的物理内存检测
> - 在新增的entry.S内核入口程序中开启了80386页机制
> - kern_init内核总控函数中通过了pmm_init函数进行整个物理内存管理器的初始化

​	通过实验指导书以及一些博客首先了解到**bootasm.S内存布局探测**，**entry.S启用分页机制**的源码部分，分析大致了解了工作流程。但个人实验最后总感觉有一些云里雾里，就是感觉这个源码东西没个可视化的方法，自己也不会那么熟练的进行什么判断，就感觉这个指导书说啥，我记啥的感觉。

​	在实现分页与物理内存管理，**初始化完毕后ucore物理内存布局示意图：**

![image-20221115201736126](C:\Users\Kyrie\AppData\Roaming\Typora\typora-user-images\image-20221115201736126.png)

后续三个练习则是**对虚拟地址进行映射/解除映射**这部分知识的实际操作。

> - 实现 first-fit 连续物理内存分配算法
> - 通过一个线性地址来得到对应的二级页表项(pmm.c中的get_pte函数)。得到这个二级页表项地址后，便可以建立起虚拟地址与物理地址的映射关系
> -  解除释放一个二级页表项与实际物理内存的映射关系(pmm.c中的page_remove_pte函数)

**实际实验过程中，结合源码中的注释提示，以及数据结构双向链表、分页式内存存储相关知识**，这三个练习的成功实现并不困难。

关于challenge部分，我们小队则是实现了challenge—1：buddy system 伙伴系统分配算法

结合该算法的C++高级语言实现，我们将其移植到ucore的内存环境下。

最终成功利用满二叉树实现该部分。（最后与助教老师在答辩环节，讨论到多级队列的数据结构形式也可以很好的实现该系统分配算法。



## 总结

​	从整个实验来看，完成三个练习结合注释和一定的基本知识能力即可。但是实验的内存分配、地址转换这类部分则较为困难。在观看源码的时候感觉很懵圈。相当于是结合别人的博客注释，再自己去搜一搜资料，让自己去接受这个晦涩的知识。感觉可能是自身对于汇编代码的阅读能力自身不足，以及是对OS内部的底层地址转换不够深入全面导致的这类困难。

​	建议：可以在每个实验结束后，能够有助教老师进行一些疑难点或者对实验的讲解（不过这学期的时间已经很短暂了，这个要求估计不太能实现，以后可以一try。

​	Github仓库地址：[kyrielw24/NKU_OS (github.com)](https://github.com/kyrielw24/NKU_OS)
